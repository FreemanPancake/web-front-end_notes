<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Band Scale</title>
    <style>
        body {
            font: 10px sans-serif;
        }
        h2 {
            margin-top: 0;
            color: grey;
        }

        .chart {
            background-color: lightgrey;
            padding: 30px;
        }
    </style>
</head>
<body>
<svg class="chart"></svg>
<script src="https://d3js.org/d3.v4.js"></script>
<script>
    const chartWidth = 1000;
    const chartHeight = 500;
    const dataset = {"India": [37, 202] ,"Probe": [54, 40] ,"Anguilla": [15, 90] ,"Germany": [76, 140] ,"Denmark": [133, 89], "Alps": [245, 89], "CEE": [109, 98], "USA": [46, 160], "Nordic": [97, 20], "China": [63, 90], "Switzerland": [89, 308], "Canada": [37, 209], "UK": [74, 190], "ARtest": [84, 39], "NJtest": [25, 40], "France": [49, 89]};
    var countriesName = [];//restore countries name
    var countriesData = [];//restore countries data
    for (var key in dataset) {
        countriesName.push(key);
        countriesData.push(dataset[key]);
    }
    const columnCount = countriesData.length;

    const xScale = d3.scaleBand()
        .domain(countriesName)
        .range([0, chartWidth])
        .padding(0.1);
    const xScale2 = d3.scaleBand()
        .domain(countriesName)
        .range([xScale.bandwidth() / 2, chartWidth + xScale.bandwidth() / 2])
        .padding(0.1);
    const textScale = d3.scaleBand()
        .domain(countriesName)
        .range([(xScale.bandwidth() / 8), (chartWidth + xScale.bandwidth() / 8)])
        .padding(0.1);
    const textScale2 = d3.scaleBand()
        .domain(countriesName)
        .range([(xScale.bandwidth() / 2) + (xScale.bandwidth() / 8), (xScale.bandwidth() / 2) + (chartWidth + xScale.bandwidth() / 8)])
        .padding(0.1);
    console.log(xScale);
    console.log(textScale);
    const svg = d3.select(".chart")
        .attr("width", chartWidth)
        .attr("height", chartHeight)
        .append("g")
        .attr("id", "histogram");

/*
var bar = chart.selectAll("g")
    .data(data)
  .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width", x)
    .attr("height", barHeight - 1);

bar.append("text")
    .attr("x", function(d) { return x(d) - 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(d) { return d; });
*/

    var bar = svg.selectAll("g")
    .data(countriesName)
    .enter().append("g")
    .attr("id", "bar");

    bar.append("rect")
    .attr("x", xScale)
    .attr("y", function(d, i){
        return chartHeight - countriesData[i][0];
    })
    .attr("width", xScale.bandwidth() / 2)
    .attr("height", function(d, i){
        return countriesData[i][0];
    })
    .style("fill", "steelblue");

    bar.append("rect")
    .attr("x", xScale2)
    .attr("y", function(d, i){
        return chartHeight - countriesData[i][1];
    })
    .attr("width", xScale.bandwidth() / 2)
    .attr("height", function(d, i){
        return countriesData[i][1];
    })
    .style("fill", "blue");

    bar.append("text")
    .attr("x", textScale)
    .attr("y", function(d, i){
        return chartHeight - countriesData[i][0] - 20;
    })
    .attr("dy", "1em")
    .text(function(d, i){
        return countriesData[i][0];
    })
    .style("fill", "white");

    bar.append("text")
    .attr("x", textScale2)
    .attr("y", function(d, i){
        return chartHeight - countriesData[i][1] - 20;
    })
    .attr("dy", "1em")
    .text(function(d, i){
        return countriesData[i][1];
    })
    .style("fill", "white");

    var rect = bar.selectAll("#bar");
    rect.transition()
    .delay(function(d, i) {
        return i * 10;
    })
    .attr("y", function(d, i){
        return chartHeight - countriesData[i];
    })
    .attr("height",  function(d, i){
        return countriesData[i];
    });

    const xAxis = d3.axisBottom(xScale);
    svg.append("g")
        .call(xAxis)
        .attr("transform", "translate(0," + chartHeight + ")"); 
    </script>
</body>
</html>